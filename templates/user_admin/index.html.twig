{% extends 'base.html.twig' %}

{% block title %}Administration des utilisateurs{% endblock %}

{% block body %}
<div class="container my-5" data-controller="admin-dashboard">
  <h1 class="mb-4">Gestion des utilisateurs</h1>

  <a href="{{ path('app_user_admin_new') }}" class="btn btn-success mb-3">
    + Nouvel utilisateur
  </a>

  <div id="user-table-container">
    {{ include('user_admin/_table.html.twig', { users: users }) }}
  </div>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script type="module">
    import { Application, Controller } from 'https://cdn.jsdelivr.net/npm/@hotwired/stimulus@3.2.2/dist/stimulus.js';

    const application = Application.start();

    class AdminDashboardController extends Controller {
      connect() {
        this.loadUserTable();
      }

      loadUserTable() {
        fetch('{{ path('app_admin_dashboard') }}', {
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(r => r.json())
        .then(json => {
          if (json.success) {
            document
              .getElementById('user-table-container')
              .innerHTML = json.html;
          }
        })
        .catch(err => console.error('Erreur AJAX', err));
      }
    }

    application.register('admin-dashboard', AdminDashboardController);
  </script>
{% endblock %}
