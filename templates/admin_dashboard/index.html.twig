{% extends 'base.html.twig' %}

{% block title %}Tableau de bord Admin{% endblock %}

{% block body %}
  <div class="container">

  <div class="rectangle">
  <div data-controller="admin-dashboard" data-admin-dashboard-active-value="ue">
    <h1>Admin page</h1>
    <div class="mb-4">
      <button
        type="button"
        class="btn btn-primary me-2"
        data-action="click->admin-dashboard#loadUeTable"
      >
        Gérer les UE
      </button>

      <button
        type="button"
        class="btn btn-secondary"
        data-action="click->admin-dashboard#loadUserTable"
      >
        Gérer les étudiants
      </button>
    </div>
    <div id="ue-container" data-admin-dashboard-target="ueContainer">
      {{ render(path('app_u_e_admin_index', { _format:'html' })) }}
    </div>
    <div id="ue-table-container"></div>
    <div id="user-table-container"></div>
  </div>
  </div>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script type="module">
    import { Application, Controller } from 'https://cdn.jsdelivr.net/npm/@hotwired/stimulus@3.2.2/dist/stimulus.js';
    const application = Application.start();

    class AdminDashboardController extends Controller {
      loadUeTable(event) {
        event.preventDefault();
        this._fetchAndInject(
          '{{ path('app_u_e_admin_index') }}',
          'ue-table-container'
        );
      }

      loadUserTable(event) {
        event.preventDefault();
        this._fetchAndInject(
          '{{ path('app_user_admin_index') }}',
          'user-table-container'
        );
      }

      _fetchAndInject(url, containerId) {
        if (containerId === 'ue-table-container') {
          document.getElementById('user-table-container').innerHTML = '';
        } else {
          document.getElementById('ue-table-container').innerHTML = '';
        }

        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
          .then(r => {
            if (!r.ok) throw new Error(`Status ${r.status}`);
            return r.json();
          })
          .then(json => {
            if (json.success) {
              document.getElementById(containerId).innerHTML = json.html;
            } else {
              console.error('Erreur AJAX', json);
            }
          })
          .catch(err => console.error('Erreur AJAX', err));
      }
    }

    application.register('admin-dashboard', AdminDashboardController);
  </script>
{% endblock %}
