{% extends 'base.html.twig' %}
{% block title %}Administration des UE{% endblock %}

{% block body %}
  <div data-controller="admin-dashboard">
    <h1 class="mb-4">Gestion des UE</h1>
    <a class="btn btn-success mb-3" href="{{ path('app_ue_admin_new') }}">+ Nouvelle UE</a>
    <div data-admin-dashboard-target="container">
      {% include 'ue_admin/_table.html.twig' with {ues: ues} %}
    </div>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script type="module">
    import { Application, Controller } from 'https://cdn.jsdelivr.net/npm/@hotwired/stimulus@3.2.2/dist/stimulus.js';
    const application = Application.start();

    class AdminDashboardController extends Controller {
      connect() {
        this.loadUeTable();
      }

      loadUeTable() {
        fetch('{{ path('app_u_e_admin_index') }}', {
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
          .then(r => r.json())
          .then(json => {
            if (json.success) {
              document
                .getElementById('ue-table-container')
                .innerHTML = json.html;
            }
          })
          .catch(e => console.error('Erreur AJAX', e));
      }
    }

    application.register('admin-dashboard', AdminDashboardController);
  </script>
{% endblock %}
