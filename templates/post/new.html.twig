{% extends 'base.html.twig' %}
{% block title %}Créer un post{% endblock %}

{% block body %}
<div class="container py-4">
  <h1 class="h4 mb-4">Créer un post</h1>
  {# Boutons selection entre texte ou fichier #}
  <div class="btn-group mb-4" role="group" aria-label="Type de post">
    <button id="tab-text" type="button" class="btn btn-primary">Texte</button>
    <button id="tab-file" type="button" class="btn btn-outline-primary">Fichier</button>
  </div>

  {# Formulaire avec action vers la route de création de post #}
  }
  {{ form_start(form, { action: path('app_post_new', { ue_id: ue.id }) }) }}

    {# Section messaage (texte) visible par défaut #}
    <div id="sect-text">
      {{ form_row(form.message, {
          attr: {
            class: 'form-control auto-resize',
            rows: 3,
            style: 'overflow:hidden; resize:none;'
          }
      }) }}
    </div>

    {# Section upload #}
    <div id="sect-file" class="d-none">
      {{ form_row(form.file_path) }}
    </div>

    {# Bouton de submit#}
    <button type="submit" class="btn btn-success">
      {{ button_label|default('Enregistrer') }}
    </button>

  {{ form_end(form) }}

  <p class="mt-3">
    <a href="{{ path('app_u_e_dashboard_show', { id: ue.id }) }}"
       class="btn btn-outline-primary">
      <i class="bi bi-arrow-left"></i>&nbsp;Retour
    </a>
  </p>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tBtn = document.getElementById('tab-text'),
            fBtn = document.getElementById('tab-file'),
            tDiv = document.getElementById('sect-text'),
            fDiv = document.getElementById('sect-file'),
            textarea = document.querySelector('.auto-resize');

      {# Fonction pour changer de section texte ou fichier #}
      function toggle(type) {
        const textMode = type === 'text';
        tDiv.classList.toggle('d-none', !textMode);
        fDiv.classList.toggle('d-none', textMode);

        tBtn.classList.toggle('btn-primary', textMode);
        tBtn.classList.toggle('btn-outline-primary', !textMode);
        fBtn.classList.toggle('btn-primary', !textMode);
        fBtn.classList.toggle('btn-outline-primary', textMode);
      }
      {# Ajustement dynamique de la hauteur de la textarea #}
      function autoResize(el) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      }

      {# Ecouteurs d'evenements #}
      tBtn.addEventListener('click', () => toggle('text'));
      fBtn.addEventListener('click', () => toggle('file'));
      textarea.addEventListener('input', () => autoResize(textarea));

      toggle('text');
      autoResize(textarea);
    });
  </script>
{% endblock %}